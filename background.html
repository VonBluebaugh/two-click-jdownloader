<script type="text/javascript">
	/* set defaults */
	var currentVersion = 1.5;

	if(localStorage["destination"] == null) { /* first run */
		/* accelerators */
		localStorage["accel.alt"] = false;
		localStorage["accel.ctrl"] = true;
		localStorage["accel.shift"] = true;
		localStorage["accel.key"] = 65; /* CTRL SHIFT a */

		/* destination */
		localStorage["destination"] = "destination.default";
		localStorage["destination.path"] = "";
		localStorage["destination.dpath"] = "";
		
		/* other */
		localStorage["other.doubleclick"] = true;
		localStorage["other.autostart"] = true;
		localStorage["other.onebyone"] = false;
	}
	localStorage["version"] = currentVersion;

	chrome.extension.onRequest.addListener(
		function(request, sender, callback) {
			if(request.command == "getOptions") {
				callback({
						command : request.command,
						destination : localStorage["destination"],
						destinationPath : localStorage["destination.path"],
						dynamicPath : localStorage["destination.dpath"],
						autostart : localStorage["other.autostart"] == "true",
						oneByOne : localStorage["other.onebyone"] == "true",
						doubleClick : localStorage["other.doubleclick"] == "true",
						accelKey : parseInt(localStorage["accel.key"]),
						accelAlt : localStorage["accel.alt"] == "true",
						accelCtrl : localStorage["accel.ctrl"] == "true",
						accelShift : localStorage["accel.shift"] == "true"
				});
			}
			else if(request.command == "saveDynamicPath") {
				localStorage["destination.dpath"] = request.dynamicPath;
				callback({});
			}
		}
	);
</script>
