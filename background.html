<script type="text/javascript">
	/* set defaults */
	var current = 0.2;

	/* if the settings were more thought out in the beginning this
	would make a bit more sense, but we can safely assume that
	having set the destination means the extension was installed.

	then at version 0.2 dynamic destination was added, so
	only that needs to be set. */

	if(localStorage["destination"] == null) { /* first run */
		/* accelerators */
		localStorage["accel.alt"] = false;
		localStorage["accel.ctrl"] = false;
		localStorage["accel.shift"] = true;
		localStorage["accel.key"] = 65; /* a */

		/* destination */
		localStorage["destination"] = "destination.default";
		localStorage["destination.path"] = "";
		localStorage["destination.dpath"] = "";
		
		/* other */
		localStorage["other.autostart"] = true;
		localStorage["other.onebyone"] = false;

		localStorage["version"] = current;
	}
	else if(localStorage["version"] != "0.2") { /* v < 0.2 */
		localStorage["destination.dpath"] = "";
		localStorage["version"] = current;
	}

	chrome.extension.onRequest.addListener(
		function(request, sender, callback) {
			if(request.command == "getOptions") {
				callback({
						command : request.command,
						destination : localStorage["destination"],
						destinationPath : localStorage["destination.path"],
						dynamicPath : localStorage["destination.dpath"],
						autostart : localStorage["other.autostart"] == "true",
						oneByOne : localStorage["other.onebyone"] == "true",
						accelKey : parseInt(localStorage["accel.key"]),
						accelAlt : localStorage["accel.alt"] == "true",
						accelCtrl : localStorage["accel.ctrl"] == "true",
						accelShift : localStorage["accel.shift"] == "true"
				});
			}
			else if(request.command == "saveDynamicPath") {
				localStorage["destination.dpath"] = request.dynamicPath;
				callback({});
			}
			else {
				callback({});
			}
		}
	);
</script>
